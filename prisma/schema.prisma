generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

// Enums
enum Role {
  SUPER_ADMIN
  ADMIN
  HR
  MANAGER
  EMPLOYEE
}

enum EmpStatus {
  ACTIVE
  PROBATION
  RESIGNED
  TERMINATED
  RETIRED
}

enum LeaveType {
  SICK
  BUSINESS
  VACATION
  MATERNITY
  PATERNITY
  UNPAID
  OTHER
}

enum LeaveStatus {
  PENDING
  APPROVED
  REJECTED
  CANCELLED
}

enum ShiftType {
  FIXED
  ROTATING
  FLEXIBLE
}

enum AttendanceStatus {
  PRESENT
  ABSENT
  LATE
  EARLY_LEAVE
  LEAVE
  HOLIDAY
  OFF
}

// Core Models

model Company {
  id       String    @id @default(cuid())
  code     String    @unique
  name     String
  address  String?
  phone    String?
  taxId    String?
  parentId String? // Self-relation for subsidiaries
  parent   Company?  @relation("CompanyHierarchy", fields: [parentId], references: [id])
  children Company[] @relation("CompanyHierarchy")

  units       Unit[]
  departments Department[]
  employees   Employee[]

  isDeleted Boolean   @default(false)
  deletedAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Unit {
  id        String  @id @default(cuid())
  code      String
  name      String
  companyId String
  company   Company @relation(fields: [companyId], references: [id])

  departments Department[]
  employees   Employee[]

  isDeleted Boolean   @default(false)
  deletedAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([companyId, code])
}

model Department {
  id        String  @id @default(cuid())
  code      String
  name      String
  companyId String
  company   Company @relation(fields: [companyId], references: [id])
  unitId    String?
  unit      Unit?   @relation(fields: [unitId], references: [id])

  positions Position[]
  employees Employee[] // Current department of employee

  parentId String? // Structural hierarchy
  parent   Department?  @relation("DeptHierarchy", fields: [parentId], references: [id])
  children Department[] @relation("DeptHierarchy")

  isDeleted Boolean   @default(false)
  deletedAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([companyId, code])
}

model Position {
  id           String     @id @default(cuid())
  code         String? // Added code for master data consistency
  title        String
  level        Int? // Job Level
  departmentId String
  department   Department @relation(fields: [departmentId], references: [id])

  jobDescriptions JobDescription[]
  employees       EmployeePosition[]

  isDeleted Boolean   @default(false)
  deletedAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model JobDescription {
  id           String   @id @default(cuid())
  positionId   String
  position     Position @relation(fields: [positionId], references: [id])
  description  String   @db.Text
  requirements String?  @db.Text

  isDeleted Boolean   @default(false)
  deletedAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model EmployeeGroup {
  id          String     @id @default(cuid())
  name        String     @unique
  description String?
  employees   Employee[]

  isDeleted Boolean   @default(false)
  deletedAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model EmployeeType {
  id          String     @id @default(cuid())
  name        String     @unique
  description String?
  employees   Employee[]

  isDeleted Boolean   @default(false)
  deletedAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model EmployeePosition {
  employeeId String
  employee   Employee @relation(fields: [employeeId], references: [id])
  positionId String
  position   Position @relation(fields: [positionId], references: [id])
  isPrimary  Boolean  @default(false)
  assignedAt DateTime @default(now())

  @@id([employeeId, positionId])
}

model LeaveTypeMaster {
  id             String  @id @default(cuid())
  code           String  @unique
  name           String
  nameTh         String?
  category       String  @default("LEAVE")
  description    String?
  isPaid         Boolean @default(true)
  maxDaysPerYear Int?

  leaveRequests LeaveRequest[]

  isDeleted Boolean   @default(false)
  deletedAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model OTTypeMaster {
  id         String @id @default(cuid())
  code       String @unique
  name       String
  multiplier Float // e.g. 1.5, 3.0

  isDeleted Boolean   @default(false)
  deletedAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model WorkingShift {
  id        String  @id @default(cuid())
  code      String  @unique
  name      String
  startTime String // e.g. "08:00"
  endTime   String // e.g. "17:00"
  workDays  String? // e.g. "Mon,Tue,Wed,Thu,Fri"

  isDeleted Boolean   @default(false)
  deletedAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  employees Employee[]
}

model Person {
  id            String    @id @default(cuid())
  idCard        String    @unique // National ID
  prefix        String?
  firstName     String
  lastName      String
  nickname      String?
  birthDate     DateTime?
  gender        String?
  maritalStatus String?
  address       String?
  mobile        String?
  lineId        String?

  employees Employee[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Holiday {
  id       String   @id @default(cuid())
  date     DateTime @unique
  name     String
  nameTh   String?
  isPublic Boolean  @default(true)

  isDeleted Boolean   @default(false)
  deletedAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Candidate {
  id              String    @id @default(cuid())
  firstName       String
  lastName        String
  email           String?
  phone           String?
  positionApplied String?
  status          String    @default("APPLICATION") // APPLICATION, INTERVIEW, OFFER, REJECTED, HIRED
  interviewDate   DateTime?

  isDeleted Boolean   @default(false)
  deletedAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model User {
  id           String  @id @default(cuid())
  username     String  @unique
  email        String? @unique
  passwordHash String
  role         Role    @default(EMPLOYEE)
  isActive     Boolean @default(true)

  employeeId String?   @unique
  employee   Employee? @relation(fields: [employeeId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Employee {
  id         String @id @default(cuid())
  employeeId String @unique // Employee Code e.g. EMP001

  // Link to Person Master Data
  personId String
  person   Person @relation(fields: [personId], references: [id])

  // Work Info
  companyId String
  company   Company @relation(fields: [companyId], references: [id])

  unitId String?
  unit   Unit?   @relation(fields: [unitId], references: [id])

  departmentId String
  department   Department @relation(fields: [departmentId], references: [id])

  // Many-to-Many Positions
  positions EmployeePosition[]

  employeeGroupId String?
  employeeGroup   EmployeeGroup? @relation(fields: [employeeGroupId], references: [id])

  employeeTypeId String?
  employeeType   EmployeeType? @relation(fields: [employeeTypeId], references: [id])

  managerId    String?
  manager      Employee?  @relation("ManagerSubordinates", fields: [managerId], references: [id])
  subordinates Employee[] @relation("ManagerSubordinates")

  workingShiftId String?
  workingShift   WorkingShift? @relation(fields: [workingShiftId], references: [id])

  joinDate      DateTime
  probationDate DateTime?
  resignDate    DateTime?
  status        EmpStatus @default(PROBATION)

  user User?

  // Modules
  attendances    Attendance[]
  leaves         LeaveRequest[]
  benefitBudgets BenefitBudget[]
  benefitClaims  BenefitClaim[]

  // Soft Delete
  isDeleted Boolean   @default(false)
  deletedAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Attendance {
  id         String   @id @default(cuid())
  employeeId String
  employee   Employee @relation(fields: [employeeId], references: [id])

  date     DateTime  @db.Date
  checkIn  DateTime?
  checkOut DateTime?

  status AttendanceStatus @default(ABSENT)
  remark String?

  isLate       Boolean @default(false)
  lateMinutes  Int     @default(0)
  isEarlyLeave Boolean @default(false)
  earlyMinutes Int     @default(0)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([employeeId, date])
}

model LeaveRequest {
  id         String   @id @default(cuid())
  employeeId String
  employee   Employee @relation(fields: [employeeId], references: [id])

  leaveTypeId String
  leaveType   LeaveTypeMaster @relation(fields: [leaveTypeId], references: [id])

  startDate DateTime
  endDate   DateTime
  days      Float // 0.5, 1.0, etc.
  reason    String?

  status LeaveStatus @default(PENDING)

  approverId      String?
  approvedAt      DateTime?
  rejectionReason String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

enum BenefitStatus {
  PENDING
  APPROVED
  REJECTED
  CANCELLED
}

// ... existing code ...

model BenefitType {
  id          String  @id @default(cuid())
  code        String  @unique
  name        String
  nameTh      String?
  description String?
  maxAmount   Float? // Optional default max per employee

  budgets BenefitBudget[]
  claims  BenefitClaim[]

  isDeleted Boolean   @default(false)
  deletedAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model BenefitBudget {
  id         String   @id @default(cuid())
  employeeId String
  employee   Employee @relation(fields: [employeeId], references: [id])

  benefitTypeId String
  benefitType   BenefitType @relation(fields: [benefitTypeId], references: [id])

  year        Int
  totalAmount Float
  usedAmount  Float @default(0)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([employeeId, benefitTypeId, year])
}

model BenefitClaim {
  id         String   @id @default(cuid())
  employeeId String
  employee   Employee @relation(fields: [employeeId], references: [id])

  benefitTypeId String
  benefitType   BenefitType @relation(fields: [benefitTypeId], references: [id])

  amount        Float
  claimDate     DateTime @default(now())
  description   String?
  attachmentUrl String? // Receipt image or document

  status BenefitStatus @default(PENDING)

  approverId      String?
  approvedAt      DateTime?
  rejectionReason String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model SystemConfig {
  id        String   @id @default(cuid())
  key       String   @unique
  value     String
  category  String? // e.g. "GENERAL", "ATTENDANCE"
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
